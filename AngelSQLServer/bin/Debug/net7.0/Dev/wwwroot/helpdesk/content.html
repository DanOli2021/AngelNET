<!DOCTYPE html>
<html>

<head>
    <title>Content Editor</title>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./bootstrap-5.3.0/css/bootstrap.min.css">

    <!-- Incluir Quill stylesheet -->
    <link href="//cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <!-- Incluir el resaltador de sintaxis Prism.js con tema "Prism Tomorrow" -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <!-- ...resto del código -->

    <style>
        #editor-section {
            margin-bottom: 20px;
        }

        #code-editor {
            width: 100%;
            height: 200px;
        }

        .post {
            border: 1px solid #3c3c3c;
            margin-top: 20px;
            margin-bottom: 20px;
            padding: 10px;
            position: relative;
        }

        .delete-button,
        .edit-button {
            position: absolute;
            top: 5px;
            cursor: pointer;
            margin-right: 60px;
        }

        .delete-button {
            margin-right: 20px;
            right: 5px;
        }

        .edit-button {
            right: 40px;
        }
    </style>

    <script>

        if (sessionStorage.getItem("Token") == null) {
            window.location.href = "index.html";
        }

        const language = getSelectedLanguage();
        const Token = JSON.parse(sessionStorage.getItem("Token"));

        const url = new URL(window.location.href);
        const params = new URLSearchParams(url.search);
        const subtopic_id = params.get('subtopic_id');
        const topic_id = params.get('topic_id');

    </script>


</head>

<body>

    <div class="container">
        <div class="row justify-content-center">

            <div class="row" style="margin-top: 10px; margin-bottom: 10px;">
                <a class="btn btn-primary btn-block" href="topic.html" id="nav_link" style="width: 100%;">
                    <span style="float: left;">
                        <img src="images/icons/beta_general_back_128.png" alt="logo" style="width:24px">
                    </span>
                    <span id="pins_menu">
                        Topic
                    </span>
                </a>
            </div>

            <div id="editor-section">
                <!-- Contenedor para el editor Quill -->
                <div id="editor" style="height: 100px;"></div>
                <br>
                <!-- Campo de texto para código -->
                <select id="language-selector">
                    <option value="csharp">C#</option>
                    <option value="vbnet">Visual Basic</option>
                    <option value="javascript">JavaScript</option>
                    <option value="css">CSS</option>
                    <option value="markup">HTML</option>
                </select>
                <textarea id="code-editor" style="height: 100px;"></textarea>
                <br>
                <input type="file" id="file-input" class="btn btn-secondary form-control"><br>
                <button onclick="savePost()" class="btn btn-primary form-control"
                    style="margin-top: 10px;">Guardar</button>
            </div>

            <div id="posts" class="row">
                <!-- Los posts se añadirán aquí -->
            </div>

            <!-- Incluir Quill library -->
            <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
            <!-- Incluir Prism.js para resaltar la sintaxis -->
            <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/prism.min.js"></script>

            <script>
                // Inicializar Quill editor
                var quill = new Quill('#editor', {
                    theme: 'snow'
                });

                function savePost() {
                    // Obtener el HTML del editor Quill
                    let text = quill.root.innerHTML;

                    // Obtener el contenido del textarea y el lenguaje seleccionado
                    const code = document.getElementById("code-editor").value;
                    const language = document.getElementById("language-selector").value;

                    // Crear un nuevo div para el post
                    const postDiv = document.createElement("div");
                    postDiv.className = "post";

                    // Añadir el HTML al post
                    postDiv.innerHTML = text;

                    // Añadir el código con resaltado de sintaxis
                    const codeBlock = document.createElement("pre");
                    codeBlock.innerHTML = `<code class="language-${language}">${code}</code>`;
                    postDiv.appendChild(codeBlock);

                    // Añadir botones de eliminar y editar
                    const deleteButton = document.createElement("span");
                    deleteButton.innerHTML = "Delete";
                    deleteButton.className = "delete-button btn btn-danger";
                    deleteButton.onclick = function () {
                        postDiv.remove();
                    };

                    const editButton = document.createElement("span");
                    editButton.innerHTML = "Edit";
                    editButton.className = "edit-button btn btn-primary";
                    editButton.onclick = function () {
                        const editedText = prompt("Editar contenido:", postDiv.innerHTML);
                        if (editedText !== null) {
                            postDiv.innerHTML = editedText;
                        }
                    };

                    postDiv.appendChild(deleteButton);
                    postDiv.appendChild(editButton);

                    // Añadir el post al comienzo de la sección de posts
                    const postsDiv = document.getElementById("posts");
                    postsDiv.insertBefore(postDiv, postsDiv.firstChild);

                    // Resaltar la sintaxis del código
                    Prism.highlightAll();
                }
            </script>

        </div>
    </div>


    <script src="./bootstrap-5.3.0/js/bootstrap.bundle.min.js"></script>

</body>

</html>